<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Translations – Mock UI</title>
  <style>
    :root{
      --bg: #0f141a;
      --text: #e6edf3;
      --muted: #9aa4b2;
      --line: #273141;
      --ok: #4bd37b;
      --radius: 10px;
      --pad: 12px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    body{
      margin:0;
      font-family: var(--sans);
      background: var(--bg);
      color: var(--text);
    }

    .topbar{
      padding: 14px 16px;
      border-bottom: 1px solid var(--line);
      display:flex;
      gap: 12px;
      align-items:center;
      position: sticky;
      top: 0;
      background: rgba(15,20,26,0.9);
      backdrop-filter: blur(6px);
      z-index: 10;
    }

    .crumbs{
      flex: 1;
      display:flex;
      gap: 8px;
      color: var(--muted);
      min-width: 240px;
      align-items: center;
      overflow:hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    .crumbs strong{ color: var(--text); }

    .controls{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
      justify-content:flex-end;
    }

    input[type="search"],
    .btn{
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid var(--line);
      background: #0b1016;
      color: var(--text);
    }

    input[type="search"]{
      width: min(360px, 60vw);
      outline: none;
    }

    .btn{
      cursor: pointer;
      user-select: none;
    }

    .btn[aria-pressed="true"]{
      border-color: rgba(74,163,255,0.7);
      box-shadow: 0 0 0 2px rgba(74,163,255,0.15) inset;
    }

    .wrap{
      padding: 16px;
      max-width: 1100px;
      margin: 0 auto;
    }

    .list{
      display:flex;
      flex-direction: column;
      gap: 10px;
    }

    details{
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(20,27,35,0.65);
      overflow: clip;
    }

    summary{
      list-style: none;
      cursor: pointer;
      padding: var(--pad);
      display:flex;
      align-items:center;
      gap: 12px;
      border-bottom: 1px solid transparent;
    }

    details[open] > summary{
      border-bottom-color: var(--line);
      background: rgba(15,20,26,0.55);
    }

    summary::-webkit-details-marker { display:none; }
    summary::marker{ content:""; }

    .twisty{
      width: 14px;
      height: 14px;
      border: 1px solid var(--line);
      border-radius: 4px;
      display:grid;
      place-items:center;
      font-size: 11px;
      color: var(--muted);
      flex: 0 0 auto;
    }
    details[open] > summary .twisty{ color: var(--text); }

    .title{
      font-family: var(--mono);
      letter-spacing: 0.4px;
      font-size: 13px;
      color: var(--text);
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .meta{
      margin-left:auto;
      display:flex;
      align-items:center;
      gap: 10px;
      color: var(--muted);
      font-size: 12px;
      flex: 0 0 auto;
    }

    .progress{
      display:flex;
      align-items:center;
      gap: 8px;
      min-width: 200px;
    }
    input[type="range"]{
      width: 120px;
      accent-color: var(--ok);
    }
    .count{
      font-variant-numeric: tabular-nums;
      min-width: 42px;
      text-align:right;
    }

    .content{
      padding: 12px;
      display:grid;
      gap: 12px;
    }

    .translations{
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(11,16,22,0.65);
      padding: 12px;
    }

    .lang-row{
      display:grid;
      grid-template-columns: 160px 1fr;
      gap: 10px;
      align-items:center;
      padding: 8px 0;
      border-top: 1px solid rgba(39,49,65,0.55);
    }
    .lang-row:first-child{ border-top: none; padding-top: 0; }

    .lang{
      display:flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }
    .lang strong{
      font-size: 13px;
      font-weight: 600;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .lang span{
      font-family: var(--mono);
      color: var(--muted);
      font-size: 12px;
    }

    .value input{
      width: 100%;
      box-sizing: border-box;
      padding: 10px 10px;
      border-radius: 8px;
      border: 1px solid var(--line);
      background: #0b1016;
      color: var(--text);
      outline: none;
    }

    .value input[data-missing="true"]{
      border-color: rgba(255,204,102,0.5);
      box-shadow: 0 0 0 2px rgba(255,204,102,0.08) inset;
    }

    .empty{
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(11,16,22,0.65);
      padding: 12px;
      color: var(--muted);
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="crumbs">
      <strong>Dashboard</strong><span>/</span>
      <strong>My Project</strong><span>/</span>
      <span>Translations</span>
    </div>

    <div class="controls">
      <input id="q" type="search" placeholder="Search keys…" />
      <button id="sort" class="btn" aria-pressed="true">Sort: Alphabetical</button>
      <button id="expandAll" class="btn">Expand all</button>
    </div>
  </header>

  <main class="wrap">
    <div id="list" class="list"></div>
  </main>

  <script>
    // -----------------------------------------------------------------------
    // INPUT MODEL (your real app will provide these)
    // -----------------------------------------------------------------------
    const translationsByIso = {
      en: {
        "ACHIEVEMENTS.FIRST_LOGIN": "{name} logged in",
        "ACTIVITY.COMMENT_ADD": "{name} added a comment",
        "ACTIVITY.PHOTO_ADD": "{name} added photo",
        "CREATE.ADDRESS": "Create address",
      },
      da: {
        "ACHIEVEMENTS.FIRST_LOGIN": "",
        "ACTIVITY.COMMENT_ADD": "{name} tilføjede en kommentar",
        "ACTIVITY.PHOTO_ADD": "{name} tilføjede et billede",
        "CREATE.ADDRESS": "",
      },
      de: {
        "ACTIVITY.PHOTO_ADD": "{name} hat ein Foto hinzugefügt",
      }
    };

    const isoToName = {
      en: "English",
      da: "Danish",
      de: "German"
    };

    // -----------------------------------------------------------------------
    // DERIVED MODEL BUILDING
    // -----------------------------------------------------------------------
    const listEl = document.getElementById("list");
    const qEl = document.getElementById("q");
    const sortBtn = document.getElementById("sort");
    const expandAllBtn = document.getElementById("expandAll");

    let sortAlpha = true;

    function getAllIsos() {
      // languages present in translationsByIso, stable order:
      // 1) any isoToName order (if keys present), 2) fallback to object order.
      const isos = Object.keys(translationsByIso);
      // if isoToName contains a subset/superset, we still only show those in translationsByIso.
      return isos;
    }

    function getAllKeys(isos) {
      const set = new Set();
      for (const iso of isos) {
        const dict = translationsByIso[iso] || {};
        for (const k of Object.keys(dict)) set.add(k);
      }
      return [...set];
    }

    function groupForKey(key) {
      // Simple grouping rule: prefix before first "."
      const idx = key.indexOf(".");
      return idx > 0 ? key.slice(0, idx) : "UNGROUPED";
    }

    function computeProgressForKey(key, isos) {
      const total = isos.length;
      let done = 0;
      for (const iso of isos) {
        const v = (translationsByIso[iso]?.[key] ?? "").trim();
        if (v.length > 0) done++;
      }
      return { done, total };
    }

    // -----------------------------------------------------------------------
    // RENDER
    // -----------------------------------------------------------------------
    function normalize(s){ return (s ?? "").toLowerCase(); }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, c => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[c]));
    }

    function escapeAttr(s){
      return escapeHtml(s).replace(/\n/g, "&#10;");
    }

    function el(html){
      const t = document.createElement("template");
      t.innerHTML = html.trim();
      return t.content.firstElementChild;
    }

    function syncTwisty(detailsEl){
      const t = detailsEl.querySelector(":scope > summary .twisty");
      if (!t) return;
      t.textContent = detailsEl.open ? "▾" : "▸";
    }

    function buildViewModel() {
      const isos = getAllIsos();
      const allKeys = getAllKeys(isos);

      const query = normalize(qEl.value);
      const filteredKeys = allKeys.filter(k => normalize(k).includes(query));

      // group -> keys[]
      const groups = new Map();
      for (const key of filteredKeys) {
        const g = groupForKey(key);
        if (!groups.has(g)) groups.set(g, []);
        groups.get(g).push(key);
      }

      // sort groups by name, keys by name (optional)
      const groupNames = [...groups.keys()].sort((a,b) => a.localeCompare(b));
      const result = groupNames.map(group => {
        let keys = groups.get(group);
        if (sortAlpha) keys = [...keys].sort((a,b) => a.localeCompare(b));
        return { group, keys };
      });

      return { isos, groups: result };
    }

    function render(){
      const { isos, groups } = buildViewModel();
      listEl.innerHTML = "";

      if (!groups.length) {
        listEl.appendChild(el(`<div class="empty">No matches. Try a different search term.</div>`));
        return;
      }

      for (const g of groups) {
        const groupDetails = el(`
          <details open>
            <summary>
              <span class="twisty">▸</span>
              <span class="title">${escapeHtml(g.group)}</span>
              <span class="meta">${g.keys.length} keys</span>
            </summary>
            <div class="content"></div>
          </details>
        `);

        const content = groupDetails.querySelector(".content");

        for (const key of g.keys) {
          const { done, total } = computeProgressForKey(key, isos);

          const keyDetails = el(`
            <details>
              <summary>
                <span class="twisty">▸</span>
                <span class="title">${escapeHtml(key)}</span>
                <span class="meta">
                  <span class="progress">
                    <input type="range" min="0" max="${total}" value="${done}" readonly />
                    <span class="count">${done}/${total}</span>
                  </span>
                </span>
              </summary>

              <div class="content">
                <div class="translations"></div>
              </div>
            </details>
          `);

          const translationsEl = keyDetails.querySelector(".translations");
          translationsEl.className = "translations";

          for (const iso of isos) {
            const langName = isoToName[iso] ?? iso;
            const value = translationsByIso[iso]?.[key] ?? "";
            const missing = String(value).trim().length === 0;

            const row = el(`
              <div class="lang-row">
                <div class="lang">
                  <strong>${escapeHtml(langName)}</strong>
                  <span>${escapeHtml(iso)}</span>
                </div>
                <div class="value">
                  <input
                    type="text"
                    value="${escapeAttr(value)}"
                    placeholder="(missing)"
                    data-missing="${missing}"
                  />
                </div>
              </div>
            `);

            translationsEl.appendChild(row);
          }

          // twisties
          keyDetails.addEventListener("toggle", () => syncTwisty(keyDetails));
          syncTwisty(keyDetails);

          content.appendChild(keyDetails);
        }

        groupDetails.addEventListener("toggle", () => syncTwisty(groupDetails));
        syncTwisty(groupDetails);

        // sync nested twisties when toggling inside
        content.querySelectorAll("details").forEach(d => d.addEventListener("toggle", () => syncTwisty(d)));

        listEl.appendChild(groupDetails);
      }
    }

    // -----------------------------------------------------------------------
    // EVENTS
    // -----------------------------------------------------------------------
    qEl.addEventListener("input", render);

    sortBtn.addEventListener("click", () => {
      sortAlpha = !sortAlpha;
      sortBtn.setAttribute("aria-pressed", String(sortAlpha));
      sortBtn.textContent = sortAlpha ? "Sort: Alphabetical" : "Sort: None";
      render();
    });

    expandAllBtn.addEventListener("click", () => {
      const groups = [...document.querySelectorAll("#list > details")];
      const allOpen = groups.length > 0 && groups.every(d => d.open);
      groups.forEach(d => d.open = !allOpen);
      groups.forEach(syncTwisty);
      expandAllBtn.textContent = allOpen ? "Expand all" : "Collapse all";
    });

    render();
  </script>
</body>
</html>
